# config.yaml - KIS API ì‹¤ì „ í™˜ê²½ ìµœì í™” (í”¼ë“œë°± ë°˜ì˜)

api:
  # âœ… ì •í™•í•œ KIS API URL (í”¼ë“œë°± ë°˜ì˜)
  base_url: "https://openapi.koreainvestment.com:9443"
  # âš ï¸ WebSocket URL ìˆ˜ì •: ì‹¤ì „ìš© (ëª¨ì˜íˆ¬ìëŠ” 31000)
  websocket_url: "ws://ops.koreainvestment.com:21000"  # ì‹¤ì „ìš©
  # websocket_url: "ws://ops.koreainvestment.com:31000"  # ëª¨ì˜íˆ¬ììš© (í•„ìš”ì‹œ ë³€ê²½)

system:
  # AWS ìµœì í™”: ì¬ì—°ê²° ì‹œë„ íšŸìˆ˜ ê°ì†Œ
  max_reconnect_attempts: 10
  base_reconnect_delay: 2
  reconnect_delay: 60
  order_retry_attempts: 3
  token_refresh_margin_minutes: 5
  cleanup_interval_hours: 6
  graceful_shutdown_timeout: 30
  
  # âœ… ìƒíƒœ ì˜ì†í™” ì¶”ê°€ (í”¼ë“œë°± ë°˜ì˜)
  state_persistence: true
  state_file: "/tmp/auto-sell-order-state.json"  # AWS í™˜ê²½ ê³ ë ¤

trading:
  profit_margin: 0.03 # 3% ìˆ˜ìµë¥ 
  default_order_type: "00" # ì§€ì •ê°€
  exchange_code: "NASD" # ë‚˜ìŠ¤ë‹¥
  # âœ… ë‚´ë¶€ ë¡œì§ìš© timezone ìˆ˜ì • (í”¼ë“œë°± ë°˜ì˜)
  timezone: "US/Eastern"  # í”„ë¦¬ì¥/ë³¸ì¥ íŒë³„ìš©

# ğŸ¯ ì§‘ì¤‘/ìŠ¤ë§ˆíŠ¸ í´ë§ ì¡°í™” ì„¤ì • (ì•ˆì „ì„± ê°•í™”)
polling:
  # ğŸ”¥ ê³µê²©ì  í´ë§ (ì§‘ì¤‘ ë§¤ë§¤ ì‹œê°„) - ê°„ê²© ì¡°ì •
  aggressive:
    # í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì§‘ì¤‘ ë§¤ë§¤ ì‹œê°„
    time_ranges:
      - start: "17:00"  # 17:00-18:00 KST (í”„ë¦¬ë§ˆì¼“)
        end: "18:00"
      - start: "21:30"  # 21:30-23:00 KST (ì •ê·œì¥ ì „í›„)
        end: "23:00"
    
    # âœ… ì•ˆì „í•œ í´ë§ ê°„ê²© (í”¼ë“œë°± ë°˜ì˜: 1ì´ˆ â†’ 3ì´ˆ)
    interval: 3  # 3ì´ˆ ê°„ê²© (KIS API ì•ˆì „ ê¸°ì¤€)
    initial_burst_interval: 2  # ì£¼ë¬¸ ë“±ë¡ ì§í›„ 2ì´ˆ
    burst_duration_minutes: 3  # 3ë¶„ê°„ ì§‘ì¤‘ ê°ì‹œ
    
    # ê³µê²©ì  ëª¨ë“œ ì„¤ì •
    max_consecutive_failures: 3
    backoff_on_failure: false  # ì‹¤íŒ¨í•´ë„ ë°±ì˜¤í”„ ì•ˆí•¨
    priority: "maximum"

  # ğŸ“Š ì¼ë°˜ ìŠ¤ë§ˆíŠ¸ í´ë§ (ë¹„ì§‘ì¤‘ ì‹œê°„)
  smart:
    # ì§‘ì¤‘ ë§¤ë§¤ ì™¸ ì‹œê°„ (18:00-21:30, 23:00-01:00)
    time_ranges:
      - start: "18:00"  # 18:00-21:30 KST
        end: "21:30"
      - start: "23:00"  # 23:00-01:00 KST
        end: "01:00"
    
    # ì ì‘í˜• ìŠ¤ë§ˆíŠ¸ í´ë§ (ì•ˆì „ ê°„ê²©)
    initial_interval: 5  # ì‹œì‘ 5ì´ˆ
    max_interval: 20     # ìµœëŒ€ 20ì´ˆ (15ì´ˆ â†’ 20ì´ˆë¡œ ì¡°ì •)
    backoff_multiplier: 1.3  # ë¶€ë“œëŸ¬ìš´ ë°±ì˜¤í”„
    
    # ìŠ¤ë§ˆíŠ¸ ì¡°ì •
    no_change_threshold: 3  # 3íšŒ ë³€í™” ì—†ìœ¼ë©´ ë°±ì˜¤í”„ ì‹œì‘
    consecutive_success_speedup: true  # ì—°ì† ì„±ê³µ ì‹œ ê°„ê²© ë‹¨ì¶•
    
    # ì£¼ë¬¸ë³„ ê°œë³„ ì¡°ì •
    order_age_factor:
      - minutes: 10
        interval: 5    # ì²˜ìŒ 10ë¶„: 5ì´ˆ
      - minutes: 30  
        interval: 8    # 10-30ë¶„: 8ì´ˆ
      - minutes: 60
        interval: 12   # 30-60ë¶„: 12ì´ˆ
      - default: 20    # 1ì‹œê°„ í›„: 20ì´ˆ

  # ğŸš« ì™„ì „ ì¤‘ì§€ ì‹œê°„
  off_hours:
    # ì·¨ì¹¨ ë° ë¹„ê±°ë˜ ì‹œê°„ (01:00-17:00 KST)
    start: "01:00"
    end: "17:00"
    
    # ì™„ì „ ì‹œìŠ¤í…œ ì¤‘ì§€ ì„¤ì •
    stop_all_monitoring: true
    stop_websocket: true
    stop_telegram_polling: true
    
    # ì¬ì‹œì‘ ì¤€ë¹„
    pre_start_minutes: 15  # 17:00 15ë¶„ ì „ë¶€í„° ì‹œìŠ¤í…œ ì¤€ë¹„

# âœ… Rate Limit ë³´í˜¸ ì„¤ì • ê°•í™” (í”¼ë“œë°± ë°˜ì˜)
rate_limit:
  # ì¼ì¼ í•œë„ (3ì´ˆ ê°„ê²© ê¸°ì¤€ ì¬ê³„ì‚°)
  daily_limit: 7000  # ì•ˆì „ ì—¬ìœ ë¶„ ê³ ë ¤
  
  # ì‹œê°„ëŒ€ë³„ í•œë„ ë¶„ë°° (3ì´ˆ ê°„ê²© ê¸°ì¤€)
  aggressive_mode_limit: 3000  # ê³µê²©ì  ëª¨ë“œ: 2.5ì‹œê°„ Ã— 1200íšŒ/ì‹œê°„
  smart_mode_limit: 4000      # ìŠ¤ë§ˆíŠ¸ ëª¨ë“œ: 5.5ì‹œê°„ Ã— 720íšŒ/ì‹œê°„
  
  # âœ… appKey ê¸°ë°˜ ì¶”ì  (í”¼ë“œë°± ë°˜ì˜)
  track_per_key: true         # appKey ë‹¨ìœ„ ì¶”ì 
  cooldown_on_limit: 60      # í•œë„ ë„ë‹¬ ì‹œ 60ì´ˆ ëŒ€ê¸°
  recovery_strategy: "slow"   # ì„œì„œíˆ ë³µêµ¬
  
  # ì•ˆì „ì¥ì¹˜ ê°•í™”
  hourly_limit: 1200          # ì‹œê°„ë‹¹ ìµœëŒ€ (3ì´ˆ ê°„ê²© ê¸°ì¤€)
  burst_protection: true      # ê¸‰ì¦ ë°©ì§€
  adaptive_throttling: true   # ì ì‘í˜• ì œí•œ
  
  # EGW00101 ë°©ì§€
  min_request_interval: 2.5   # ìµœì†Œ 2.5ì´ˆ ê°„ê²© ë³´ì¥
  consecutive_limit: 10       # ì—°ì† ìš”ì²­ ì œí•œ

# AWS ìµœì í™”: í…”ë ˆê·¸ë¨ ì„¤ì • (ì¡°ì •ë¨)
telegram:
  # ë§¤ë§¤ ì‹œê°„ì— ë”°ë¥¸ í´ë§ ì¡°ì •
  polling_intervals:
    aggressive_mode: 8   # ì§‘ì¤‘ ì‹œê°„: 8ì´ˆ (5ì´ˆ â†’ 8ì´ˆ)
    smart_mode: 20       # ì¼ë°˜ ì‹œê°„: 20ì´ˆ (15ì´ˆ â†’ 20ì´ˆ)
    off_hours: 3600      # ì¤‘ì§€ ì‹œê°„: 1ì‹œê°„ (ì‚¬ì‹¤ìƒ ì¤‘ì§€)
  
  error_polling_interval: 90   # 60ì´ˆ â†’ 90ì´ˆ
  timeout: 15
  
  # ì•Œë¦¼ ìš°ì„ ìˆœìœ„
  priority_notifications:
    - "ì²´ê²° ê°ì§€"
    - "ìë™ ë§¤ë„ ì„±ê³µ"
    - "ì‹œìŠ¤í…œ ëª¨ë“œ ì „í™˜"
    - "Rate Limit ê²½ê³ "
    - "ì˜¤ë¥˜ ë°œìƒ"

logging:
  file_max_bytes: 10485760 # 10MB
  backup_count: 5
  
  # ë§¤ë§¤ ì‹œê°„ì— ë”°ë¥¸ ë¡œê¹… ë ˆë²¨ ì¡°ì •
  levels:
    aggressive_mode: "INFO"   # ì§‘ì¤‘ ì‹œê°„: ìƒì„¸ ë¡œê¹…
    smart_mode: "INFO"        # ì¼ë°˜ ì‹œê°„: ê¸°ë³¸ ë¡œê¹…
    off_hours: "WARNING"      # ì¤‘ì§€ ì‹œê°„: ìµœì†Œ ë¡œê¹…
  
  # ì„±ëŠ¥ í†µê³„ ë¡œê¹…
  stats_interval_minutes: 30
  detailed_stats: true
  
  # KIS API ì‘ë‹µ ë¡œê¹…
  api_response_logging: true
  rate_limit_tracking: true

# ì›¹ ì¸í„°í˜ì´ìŠ¤ ì„¤ì •
web:
  enabled: false  # ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë¹„í™œì„±í™”
  host: "127.0.0.1"
  port: 5000
  
# ğŸ¯ ë§¤ë§¤ ì „ëµë³„ ì„¸ë¶€ ì„¤ì •
strategy:
  # ì§‘ì¤‘ ë§¤ë§¤ ì‹œê°„ ì „ëµ
  aggressive_strategy:
    target_profit_margin: 0.035  # 3.5% (ì¡°ê¸ˆ ë” ê³µê²©ì )
    quick_exit_enabled: true     # ë¹ ë¥¸ ì²­ì‚° í—ˆìš©
    market_order_threshold: 0.025 # 2.5% ì´ìƒ ìˆ˜ìµ ì‹œ ì‹œì¥ê°€ í—ˆìš©
    max_hold_minutes: 30         # ìµœëŒ€ 30ë¶„ ë³´ìœ 
    
  # ì¼ë°˜ ì‹œê°„ ì „ëµ  
  smart_strategy:
    target_profit_margin: 0.03   # 3% (ê¸°ë³¸)
    patience_mode: true          # ì¸ë‚´ì‹¬ ëª¨ë“œ
    limit_order_only: true       # ì§€ì •ê°€ë§Œ ì‚¬ìš©
    max_hold_hours: 2            # ìµœëŒ€ 2ì‹œê°„ ë³´ìœ 

# ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§
monitoring:
  health_check_interval: 300  # 5ë¶„
  performance_tracking: true
  cost_optimization: true
  
  # ì§‘ì¤‘ ì‹œê°„ ì„±ê³¼ ì¶”ì 
  aggressive_mode_stats: true
  daily_summary: true
  weekly_report: true
  
  # KIS API ìƒíƒœ ëª¨ë‹ˆí„°ë§
  api_health_check: true
  websocket_connection_monitor: true

# âœ… ì‹œê°„ëŒ€ ì„¤ì • ë¶„ë¦¬ (í”¼ë“œë°± ë°˜ì˜)
scheduler:
  # í‘œì‹œìš© ì‹œê°„ëŒ€ (ì‚¬ìš©ì ê¸°ì¤€)
  timezone: "Asia/Seoul"
  auto_mode_switching: true
  
  # ëª¨ë“œ ì „í™˜ ì•Œë¦¼
  mode_change_notification: true
  pre_mode_change_warning: 5  # 5ë¶„ ì „ ì•Œë¦¼
  
  # ì‹œìŠ¤í…œ ìë™ ì¬ì‹œì‘
  daily_restart: "16:45"  # ë§¤ë§¤ ì‹œì‘ 15ë¶„ ì „ ì¬ì‹œì‘
  
  # ì‹œê°„ëŒ€ë³„ ë™ì‘ ì„¤ì •
  market_timezone: "US/Eastern"    # ë‚´ë¶€ ë¡œì§ìš©
  display_timezone: "Asia/Seoul"   # ì‚¬ìš©ì í‘œì‹œìš©

# KIS API íŠ¹í™” ì„¤ì •
kis_api:
  # ì—°ê²° ì•ˆì •ì„±
  connection_pool_size: 5
  request_timeout: 15
  retry_attempts: 3
  
  # WebSocket ì„¤ì •
  websocket:
    ping_interval: 30
    ping_timeout: 10
    max_reconnect_attempts: 5
    reconnect_delay: 10
  
  # ì˜¤ë¥˜ ì½”ë“œë³„ ì²˜ë¦¬
  error_handling:
    EGW00101: "rate_limit"    # Rate Limit
    EGW00102: "rate_limit"    # Rate Limit
    EGW90001: "retry"         # ì¼ì‹œì  ì˜¤ë¥˜
    
# ìš´ì˜ í™˜ê²½ë³„ ì„¤ì •
environment:
  # ê°œë°œ/ìš´ì˜ êµ¬ë¶„
  mode: "production"  # development, production
  
  # AWS í™˜ê²½ ìµœì í™”
  aws_optimized: true
  cloudwatch_logging: false  # í•„ìš”ì‹œ í™œì„±í™”
  
  # ë¹„ìš© ìµœì í™”
  cost_optimization:
    enabled: true
    target_monthly_cost: 50  # USD
    alert_threshold: 80      # 80% ë„ë‹¬ ì‹œ ì•Œë¦¼