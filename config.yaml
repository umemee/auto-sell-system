# config.yaml - 자동매매 시스템 설정

api:
  base_url: "https://openapi.koreainvestment.com:9443"
  websocket_url: "ws://ops.koreainvestment.com:21000"
  request_timeout: 15

system:
  token_refresh_margin_minutes: 5
  approval_margin_seconds: 1800
  state_file: "/tmp/auto-sell-order-state.json"
  graceful_shutdown_timeout: 30
  max_reconnect_attempts: 10
  base_reconnect_delay: 5

trading:
  profit_margin: 0.03
  exchange_code: "NASD"
  default_order_type: "00"
  timezone: "US/Eastern"
  default_symbol: "AAPL"

telegram:
  polling_interval: 10
  error_polling_interval: 30
  timeout: 10

rate_limit:
  requests_per_second: 1
  daily_limit: 5000
  hourly_limit: 500
  min_request_interval: 2.5
  consecutive_limit: 10
  cooldown_on_limit: 60
  aggressive_mode_limit: 1000
  smart_mode_limit: 2000

# ✅ 코드와 호환되는 polling 구조
polling:
  # 1) aggressive 모드 (프리마켓 시간대 - 3초 간격)
  aggressive:
    interval: 3
    time_ranges:
      - {start: "17:00", end: "23:30"}  # KST 17:00-23:30 = ET 04:00-09:30
  
  # 2) smart 모드 (애프터마켓 시간대 - 가변 간격)
  smart:
    initial_interval: 5
    max_interval: 30
    backoff_multiplier: 1.2
    no_change_threshold: 5
    consecutive_success_speedup: true
    time_ranges:
      - {start: "00:30", end: "09:00"}  # KST 00:30-09:00 = ET 09:30-20:00
    order_age_factor:
      - {minutes: 5, interval: 10}
      - {minutes: 15, interval: 20}
      - {default: 30}
  
  # 3) WebSocket 모드 (정규장 시간대)
  ws_mode:
    time_ranges:
      - {start: "23:30", end: "06:00"}  # KST 23:30-06:00 = ET 09:30-16:00

# 전략 설정
strategy:
  aggressive_strategy:
    target_profit_margin: 0.03
  smart_strategy:
    target_profit_margin: 0.03

logging:
  level: "INFO"
EOF

echo "✅ config.yaml 수정 완료"